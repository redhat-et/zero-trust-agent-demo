apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: spiffe-demo-authbridge

# Build on top of the local overlay (SPIFFE CSI driver + Keycloak)
resources:
  - ../local
  - authbridge-configmaps.yaml
  - authbridge-secrets.yaml

images:
  - name: ghcr.io/kagenti/kagenti-extensions/envoy-with-processor
    newName: localhost/spiffe-demo/envoy-with-processor
    newTag: latest
  - name: jaeger
    newName: jaegertracing/jaeger
    newTag: "2.15.0"
  - name: otel-collector
    newName: otel/opentelemetry-collector-contrib
    newTag: "0.120.0"

patches:
  - path: agent-service-authbridge-patch.yaml
  - path: document-service-jwt-patch.yaml
  - path: dashboard-authbridge-patch.yaml
  - path: user-service-authbridge-patch.yaml
  - path: keycloak-hostname-patch.yaml
